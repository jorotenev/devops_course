# Домашно 1
Цел - при качване на файл в S3 bucket, да се trigger-ва ламбда, която да показва съдържанието на качения файл.

Създайте S3 bucket, който да се казва - `progressbg-devops-2020-<вашия IAM user name>`. Може да го създадете през AWS UI Console-ата, през AWS CLI-a или през SDK-a - както ви е най-удобно :)

След това, създайте Lambda функция, която:
* да се казва `<вашия IAM user name>-progress-test`
* като IAM role за вашата Lambda използвайте `progress-lambda-role` __(вече съм я създал за вас)__.
* настройте вашата Lambda да се trigger-ва от S3 при качване на файл в даден bucket. 
  * когато отворите създадената Lambda горе в ляво има бутон Add trigger
  * Задайте S3 bucket-a, който създадохте горе.
* кода на ламбдата можете да го пишете директно в browser-а или първо да го напишете локално и после да го копирате в code editor-a на Lambda-та.



Когато има такъв trigger, всеки път, когато се upload-не файл във вашия S3 bucket, ще се прати `event` към вашата lambda, който ще съдържа името на bucket-a, в който се е качил файл и името на самия файл (+ още meta данни).
  * [тук](https://docs.aws.amazon.com/lambda/latest/dg/with-s3.html) има примерна структура на event-a който вашата ламбда ще получи. Съобразете кода си спрямо тази структура

Единственото, което вашата Lambda трябва да прави е да прочете съдържанието на файла, който е бил качен в S3, и да го принтира. Разгледайте в google как може да ползвате boto3 за да четете съдържанието на S3 file :) 

При проблеми ми пишете.  Настроил съм акаунта през IAM така че да не можете да виждате решенията на останалите. Ако виждате Access Denied или друга грешка - пишете ми.


## Hints
* Тестване - докато пишете кода ще искате да можете лесно да тествате дали работи правилно. За това често взимам съдържанието на някакъв примерен trigger event и го ползвам, докато пиша кода на моята ламбда. По този начин мога да тествам и локално (на моя компютър) и няма нужда някой trigger наистина да trigger-ва ламбдата - достатъчно е да имам съдържанието на примерен event.
* тестване на кода на ламбдата локално
  * можете да тествате вашия код локално - трябва да имате `lambda_handler(event, context)` метод - той ще бъде изпълняван когато Lambda извика вашия код. Под `if __name__ == '__main':` можете да сложите тестов код, който да извика вашия метод с тестов event. Това е удобен трик, защото позволява да тествате вашата ламбда локално като изпълните python файла. Код в споменатия `if` блок ще бъде изпълнен само когато скрипта се извика директно. По този начин, когато качите вашия код в Lambda, тестовия код в if блока няма да бъде изпълнен.
  ```python
  import json
  def lambda_handler(event, context):
    print(event)
    return {'statusCode': 200,'body':json.dumps('hi')}
  if __name__=='__main__':
    
    sample_event = {...} # sample_event го взете от линка гора с примерна структура 
    lambda_handler(sample_event,None)
  ```
  * python кода горе може да изпълните локално
    * трябва да имате инсталиран boto3 python библиотеката
    
  * Ако ще изпълнявате кода локално - първо сложете файл във вашия S3 бъкет за да има какъв файл (object) да сложите в sample_event
* тестване на кода през браузъра
  * когато отворите ламбдата - можете да пишете кода в текстовия редактор.
    * __NB__ не забравяйте да натиснете Deploy когато правите промени по кода на ламбдата
  * горе в дясно можете да създадете нов тестов event (Select a test event -> Configure - new ) - json (можете да вземете примерен от линка горе за примерна структура на S3 event). След като запазите тестовия евент, можете да натиснете Test бутона горе в дясно - това ще задейства вашата ламбда като й подаде тестовия event като input - така се симулира истински тригър.


 
Когато сте написали вашия код, създали сте Lambda функция, качили сте кода ви в ламбдата и сте добавили Trigger - вече може да пробвате да качите файл в S3 и да видите какви логове е написала вашата ламбда.  
* __NB__ не забравяйте да натиснете Deploy когато правите промени по кода на ламбдата

За да видите какво е принтирала вашата ламбда, отидете в Monitoring таб-а, след това отворете View logs in CloudWatch, Search Log Group. След това може да изберете последните 5 минути, за да видите скорошните логове на вашата ламбда

* разгледайте [тук](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html) как да конфигурирате credentials локално (които ще важат както и за AWS CLI & boto3)
* за да качите файл в S3  
    * през CLI - `aws s3 cp some_local_file.txt s3://somebucketname`
    * през UI-a - отивате в Services -> S3, отивате в bucket-a и после Upload File.
